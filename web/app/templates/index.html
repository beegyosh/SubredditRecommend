<html>
<head>
	<title>{{title}}</title>
	<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" media="screen">
</head>

<!-- Style for D3 -->
<style>

circle {
  fill: rgb(31, 119, 180);
  fill-opacity: 0.5;
  stroke: rgb(31, 119, 180);
  stroke-width: 1px;
}

.leaf circle {
  fill: #ff7f0e;
  fill-opacity: 1;
}

text {
  font: 14px sans-serif;
}
</style>
<!------------------>


<body>
	<h1>Subreddit Recommendation</h1>
	<form role="form" method='POST' action='/'>
		<div>{{ form.userInput }}</div><br>
		<div class="radio">
			{{ form.csrf_token }}
			{{ form.inputType }}
		</div><br>
		<button type="submit">Submit</button>
	</form>
	<br>
		{% for error in errors %}
			<h4>{{ error }}</h4>
		{% endfor %}
	<!--<table>
	{% for key, value in rec %}
		<tr>
			<th> {{ key }} </th>
			<td> {{ value }} </td>
		</tr>
	{% endfor %}
	</table>-->
	<div class="chart"></div>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script>
        var json = {
         "name": "data",
         "children": [
          {
             "name": "topics",
             "children": [
              {% for i in recList %}
                {{ i|safe }}
              {% endfor %}
             ]
            }
           ]
        };

        var r = 1500,
            format = d3.format(",d"),
            fill = d3.scale.category20c();

        var bubble = d3.layout.pack()
            .sort(null)
            .size([r, r])
            .padding(1.5);

        var vis = d3.select("#chart").append("svg")
            .attr("width", r)
            .attr("height", r)
            .attr("class", "bubble");

          
        var node = vis.selectAll("g.node")
            .data(bubble.nodes(classes(json))
            .filter(function(d) { return !d.children; }))
            .enter().append("g")
            .attr("class", "node")
            .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
            color = d3.scale.category20();
          
          node.append("title")
              .text(function(d) { return d.className + ": " + format(d.value); });

          node.append("circle")
              .attr("r", function(d) { return d.r; })
              .style("fill", function(d) {return color(d.topicName);});

        var text = node.append("text")
            .attr("text-anchor", "middle")
            .attr("dy", ".3em")
            .text(function(d) { return d.className.substring(0, d.r / 3)});
          
          text.append("tspan")
              .attr("dy", "1.2em")
              .attr("x", 0)
              .text(function(d) {return Math.ceil(d.value * 10000) /10000; });

        // Returns a flattened hierarchy containing all leaf nodes under the root.
        function classes(root) {
          var classes = [];

          function recurse(term, node) {
            if (node.children) node.children.forEach(function(child) { recurse(node.subreddit, child); });
            else classes.push({topicName: node.id, className: node.subreddit, value: node.sim});
          }

          recurse(null, root);
          return {children: classes};
        }
    </script>
	
	<script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>
</html>
